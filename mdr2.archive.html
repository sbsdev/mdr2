<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>mdr2.archive documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Madras2 0.3.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mdr2</span></div></div></li><li class="depth-2"><a href="mdr2.abacus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>abacus</span></div></a></li><li class="depth-3 branch"><a href="mdr2.abacus.import.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>import</span></div></a></li><li class="depth-3"><a href="mdr2.abacus.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch current"><a href="mdr2.archive.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>archive</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></div></li><li class="depth-3"><a href="mdr2.data.xml.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xml</span></div></a></li><li class="depth-2 branch"><a href="mdr2.db.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2"><a href="mdr2.dtb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dtb</span></div></a></li><li class="depth-3"><a href="mdr2.dtb.xml.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xml</span></div></a></li><li class="depth-2"><a href="mdr2.dtbook.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>dtbook</span></div></a></li><li class="depth-3"><a href="mdr2.dtbook.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.encode.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>encode</span></div></a></li><li class="depth-2 branch"><a href="mdr2.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-2 branch"><a href="mdr2.layout.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>layout</span></div></a></li><li class="depth-2 branch"><a href="mdr2.main.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>main</span></div></a></li><li class="depth-2 branch"><a href="mdr2.obi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>obi</span></div></a></li><li class="depth-2 branch"><a href="mdr2.pipeline1.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline1</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline2</span></div></div></li><li class="depth-3 branch"><a href="mdr2.pipeline2.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="mdr2.pipeline2.scripts.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scripts</span></div></a></li><li class="depth-3"><a href="mdr2.pipeline2.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-2 branch"><a href="mdr2.production.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>production</span></div></a></li><li class="depth-2"><a href="mdr2.production-monitoring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>production-monitoring</span></div></a></li><li class="depth-3"><a href="mdr2.production.path.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>path</span></div></a></li><li class="depth-2 branch"><a href="mdr2.queues.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>queues</span></div></a></li><li class="depth-2 branch"><a href="mdr2.rdf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rdf</span></div></a></li><li class="depth-2 branch"><a href="mdr2.repair.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repair</span></div></a></li><li class="depth-2 branch"><a href="mdr2.schema-validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema-validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="mdr2.views.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>views</span></div></a></li><li class="depth-2"><a href="mdr2.vubis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vubis</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="mdr2.archive.html#var-archive"><div class="inner"><span>archive</span></div></a></li><li class="depth-1"><a href="mdr2.archive.html#var-container-path"><div class="inner"><span>container-path</span></div></a></li><li class="depth-1"><a href="mdr2.archive.html#var-container-rdf-path"><div class="inner"><span>container-rdf-path</span></div></a></li><li class="depth-1"><a href="mdr2.archive.html#var-container-root-path"><div class="inner"><span>container-root-path</span></div></a></li><li class="depth-1"><a href="mdr2.archive.html#var-other-spool-dir"><div class="inner"><span>other-spool-dir</span></div></a></li><li class="depth-1"><a href="mdr2.archive.html#var-periodical-spool-dir"><div class="inner"><span>periodical-spool-dir</span></div></a></li><li class="depth-1"><a href="mdr2.archive.html#var-set-file-permissions"><div class="inner"><span>set-file-permissions</span></div></a></li><li class="depth-1"><a href="mdr2.archive.html#var-spool-dir"><div class="inner"><span>spool-dir</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">mdr2.archive</h2><div class="doc"><div class="markdown"><p>Main entry point into the archive</p><p>For archiving we need to interface with an existing legacy system named agadir. It doesn&rsquo;t do very much in very complicated ways. Probably best to replace it at some point. In the mean time we try to stay away from it and not to change too much. From reading the source it appears that in order to archive a production you need to first archive what they call the <em>master</em>, i.e. the dtb containing the wav files and after that you&rsquo;ll have to archive the so-called <em>distribution master</em> which is basically the same thing but the audio is encoded as mp3 and the whole thing is packed up in one or more iso files</p><h3>Archiving the <em>master</em></h3>
<ol>
  <li>place it in a magic spool directory</li>
  <li>generate an rdf file containing some meta data about the production</li>
  <li>add an entry to a table in a database. Specify the <code>sektion</code> to be <code>master</code></li>
</ol><h3>Archiving the <em>distribution master</em></h3>
<ol>
  <li>Encode the audio to mp3</li>
  <li>Pack everything up in an iso</li>
  <li>place this iso in the magic spool directory</li>
  <li>generate the rdf as above</li>
  <li>add an entry to a table in a database. The <code>sektion</code> should be <code>cdimage</code></li>
</ol></div></div><div class="public anchor" id="var-archive"><h3>archive</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Archive a <code>production</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L181">view source</a></div></div><div class="public anchor" id="var-container-path"><h3>container-path</h3><div class="usage"><code>(container-path production sektion)</code></div><div class="doc"><div class="markdown"><p>Return the path to the archive spool directory for a given <code>production</code> and <code>sektion</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L82">view source</a></div></div><div class="public anchor" id="var-container-rdf-path"><h3>container-rdf-path</h3><div class="usage"><code>(container-rdf-path production sektion)</code></div><div class="doc"><div class="markdown"><p>Return the path to the rdf file in the archive spool for a given <code>production</code> and <code>sektion</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L89">view source</a></div></div><div class="public anchor" id="var-container-root-path"><h3>container-root-path</h3><div class="usage"><code>(container-root-path production sektion)</code></div><div class="doc"><div class="markdown"><p>Return the root container path for a given <code>production</code> and <code>sektion</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L76">view source</a></div></div><div class="public anchor" id="var-other-spool-dir"><h3>other-spool-dir</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Path to the archive spool directory for other productions</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L59">view source</a></div></div><div class="public anchor" id="var-periodical-spool-dir"><h3>periodical-spool-dir</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Path to the archive spool directory for periodicals</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L55">view source</a></div></div><div class="public anchor" id="var-set-file-permissions"><h3>set-file-permissions</h3><div class="usage"><code>(set-file-permissions file-tree)</code></div><div class="doc"><div class="markdown"><p>Set file permissions on <code>root</code> to g+w recursively</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L127">view source</a></div></div><div class="public anchor" id="var-spool-dir"><h3>spool-dir</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Path to the archive spool directory, i.e. where to place incoming productions that are to be archived</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/archive.clj#L50">view source</a></div></div></div></body></html>
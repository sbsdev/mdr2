<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>mdr2.repair documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Madras2 0.3.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mdr2</span></div></div></li><li class="depth-2"><a href="mdr2.abacus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>abacus</span></div></a></li><li class="depth-3 branch"><a href="mdr2.abacus.import.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>import</span></div></a></li><li class="depth-3"><a href="mdr2.abacus.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.archive.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>archive</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></div></li><li class="depth-3"><a href="mdr2.data.xml.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xml</span></div></a></li><li class="depth-2 branch"><a href="mdr2.db.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2"><a href="mdr2.dtb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dtb</span></div></a></li><li class="depth-3"><a href="mdr2.dtb.xml.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xml</span></div></a></li><li class="depth-2"><a href="mdr2.dtbook.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>dtbook</span></div></a></li><li class="depth-3"><a href="mdr2.dtbook.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.encode.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>encode</span></div></a></li><li class="depth-2 branch"><a href="mdr2.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-2 branch"><a href="mdr2.layout.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>layout</span></div></a></li><li class="depth-2 branch"><a href="mdr2.main.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>main</span></div></a></li><li class="depth-2 branch"><a href="mdr2.obi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>obi</span></div></a></li><li class="depth-2 branch"><a href="mdr2.pipeline1.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline1</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline2</span></div></div></li><li class="depth-3 branch"><a href="mdr2.pipeline2.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="mdr2.pipeline2.scripts.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scripts</span></div></a></li><li class="depth-3"><a href="mdr2.pipeline2.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-2 branch"><a href="mdr2.production.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>production</span></div></a></li><li class="depth-2"><a href="mdr2.production-monitoring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>production-monitoring</span></div></a></li><li class="depth-3"><a href="mdr2.production.path.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>path</span></div></a></li><li class="depth-2 branch"><a href="mdr2.queues.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>queues</span></div></a></li><li class="depth-2 branch"><a href="mdr2.rdf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rdf</span></div></a></li><li class="depth-2 branch current"><a href="mdr2.repair.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repair</span></div></a></li><li class="depth-2 branch"><a href="mdr2.schema-validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema-validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="mdr2.views.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>views</span></div></a></li><li class="depth-2"><a href="mdr2.vubis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vubis</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="mdr2.repair.html#var-archive-identifier.3F"><div class="inner"><span>archive-identifier?</span></div></a></li><li class="depth-1"><a href="mdr2.repair.html#var-archive-url"><div class="inner"><span>archive-url</span></div></a></li><li class="depth-1"><a href="mdr2.repair.html#var-container-id"><div class="inner"><span>container-id</span></div></a></li><li class="depth-1"><a href="mdr2.repair.html#var-product-number.3F"><div class="inner"><span>product-number?</span></div></a></li><li class="depth-1"><a href="mdr2.repair.html#var-production-id-to-archive-id"><div class="inner"><span>production-id-to-archive-id</span></div></a></li><li class="depth-1"><a href="mdr2.repair.html#var-production-id.3F"><div class="inner"><span>production-id?</span></div></a></li><li class="depth-1"><a href="mdr2.repair.html#var-repair"><div class="inner"><span>repair</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">mdr2.repair</h2><div class="doc"><div class="markdown"><p>Functions to handle repairing of a production</p><p>This mostly entails functionality to fetch a production from the archive.</p><p>A production is stored in the archive as a tar file. There is a HTTP API to the archive which is used to fetch productions. The tar file is then unpacked in a tmp dir inside the structured path (as there is not enough space in the /tmp dir). From this temporary location all the relevant files are copied to the structured path and the production is set to state &ldquo;structured&rdquo;. After that the repair takes its course down the same route as a normal production.</p></div></div><div class="public anchor" id="var-archive-identifier.3F"><h3>archive-identifier?</h3><div class="usage"><code>(archive-identifier? id)</code></div><div class="doc"><div class="markdown"><p>Return true if <code>id</code> is either a valid production id, i.e. a dam number or a valid library signature</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/repair.clj#L44">view source</a></div></div><div class="public anchor" id="var-archive-url"><h3>archive-url</h3><div class="usage"><code>(archive-url container-id)</code></div><div class="doc"><div class="markdown"><p>Return the url for an archived production given a <code>container-id</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/repair.clj#L50">view source</a></div></div><div class="public anchor" id="var-container-id"><h3>container-id</h3><div class="usage"><code>(container-id production)</code><code>(container-id production sektion)</code></div><div class="doc"><div class="markdown"><p>Return a container-id given a <code>production</code> and optionally <code>sektion</code> which can be either <code>:master</code> or <code>:dist-master</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/repair.clj#L58">view source</a></div></div><div class="public anchor" id="var-product-number.3F"><h3>product-number?</h3><div class="usage"><code>(product-number? id)</code></div><div class="doc"><div class="markdown"><p>Return true if <code>id</code> is a valid product number</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/repair.clj#L39">view source</a></div></div><div class="public anchor" id="var-production-id-to-archive-id"><h3>production-id-to-archive-id</h3><div class="usage"><code>(production-id-to-archive-id {:keys (id)})</code><code>(production-id-to-archive-id {:keys (id)} {:keys [connection]})</code></div><div class="doc"><div class="markdown"><p>Return an archive id for a given production id, i.e. dam number</p></div></div></div><div class="public anchor" id="var-production-id.3F"><h3>production-id?</h3><div class="usage"><code>(production-id? id)</code></div><div class="doc"><div class="markdown"><p>Return true if <code>id</code> is a valid production id</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/repair.clj#L34">view source</a></div></div><div class="public anchor" id="var-repair"><h3>repair</h3><div class="usage"><code>(repair production)</code></div><div class="doc"><div class="markdown"><p>Get a production from the archive and prepare it for repairing</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/repair.clj#L69">view source</a></div></div></div></body></html>
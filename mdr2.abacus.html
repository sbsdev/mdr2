<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>mdr2.abacus documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Madras2 0.3.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mdr2</span></div></div></li><li class="depth-2 current"><a href="mdr2.abacus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>abacus</span></div></a></li><li class="depth-3 branch"><a href="mdr2.abacus.import.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>import</span></div></a></li><li class="depth-3"><a href="mdr2.abacus.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.archive.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>archive</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></div></li><li class="depth-3"><a href="mdr2.data.xml.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xml</span></div></a></li><li class="depth-2 branch"><a href="mdr2.db.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2"><a href="mdr2.dtb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dtb</span></div></a></li><li class="depth-3"><a href="mdr2.dtb.xml.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xml</span></div></a></li><li class="depth-2"><a href="mdr2.dtbook.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>dtbook</span></div></a></li><li class="depth-3"><a href="mdr2.dtbook.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.encode.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>encode</span></div></a></li><li class="depth-2 branch"><a href="mdr2.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-2 branch"><a href="mdr2.layout.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>layout</span></div></a></li><li class="depth-2 branch"><a href="mdr2.main.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>main</span></div></a></li><li class="depth-2 branch"><a href="mdr2.obi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>obi</span></div></a></li><li class="depth-2 branch"><a href="mdr2.pipeline1.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline1</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline2</span></div></div></li><li class="depth-3 branch"><a href="mdr2.pipeline2.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="mdr2.pipeline2.scripts.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scripts</span></div></a></li><li class="depth-3"><a href="mdr2.pipeline2.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-2 branch"><a href="mdr2.production.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>production</span></div></a></li><li class="depth-2"><a href="mdr2.production-monitoring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>production-monitoring</span></div></a></li><li class="depth-3"><a href="mdr2.production.path.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>path</span></div></a></li><li class="depth-2 branch"><a href="mdr2.queues.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>queues</span></div></a></li><li class="depth-2 branch"><a href="mdr2.rdf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rdf</span></div></a></li><li class="depth-2 branch"><a href="mdr2.repair.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repair</span></div></a></li><li class="depth-2 branch"><a href="mdr2.schema-validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema-validation</span></div></a></li><li class="depth-2 branch"><a href="mdr2.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="mdr2.views.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>views</span></div></a></li><li class="depth-2"><a href="mdr2.vubis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vubis</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="mdr2.abacus.html#var-clean-raw-production"><div class="inner"><span>clean-raw-production</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-create-row"><div class="inner"><span>create-row</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-export"><div class="inner"><span>export</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-export-file"><div class="inner"><span>export-file</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-import-metadata-update"><div class="inner"><span>import-metadata-update</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-import-new-production"><div class="inner"><span>import-new-production</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-import-recorded-production"><div class="inner"><span>import-recorded-production</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-import-status-request"><div class="inner"><span>import-status-request</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-read-file"><div class="inner"><span>read-file</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-source-date"><div class="inner"><span>source-date</span></div></a></li><li class="depth-1"><a href="mdr2.abacus.html#var-wrap-rows"><div class="inner"><span>wrap-rows</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">mdr2.abacus</h2><div class="doc"><div class="markdown"><p>Import and export files to and from ABACUS</p><p>Unfortunately the interface to our ERP is very crude: you basically read and write files from an directory. The import from ABACUS is done via XML and the export to ABACUS is done via some form of csv. The interface imports the following notifications:</p>
<ul>
  <li>Start (open) a production</li>
  <li>a production is recorded</li>
  <li>Meta data updates</li>
</ul><p>and the interface sends notifications to ABACUS when:</p>
<ul>
  <li>the state of a production changes</li>
  <li>meta data of a production changes.</li>
</ul></div></div><div class="public anchor" id="var-clean-raw-production"><h3>clean-raw-production</h3><div class="usage"><code>(clean-raw-production {:keys [mvl_only command idVorstufe], :as raw-production})</code></div><div class="doc"><div class="markdown"><p>Return a proper production based on a raw production, i.e. drop <code>:mvl_only</code>, <code>:command</code> and <code>:idVorstufe</code> and add <code>:production_type</code> and <code>periodical_number</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L60">view source</a></div></div><div class="public anchor" id="var-create-row"><h3>create-row</h3><div class="usage"><code>(create-row k v)</code></div><div class="doc"><div class="markdown"><p>Create a row for export according to ABACUS conventions</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L166">view source</a></div></div><div class="public anchor" id="var-export"><h3>export</h3><div class="usage"><code>(export {:keys [product_number total_time state audio_format multimedia_type date id produced_date volumes depth], :as production})</code></div><div class="doc"><div class="markdown"><p>Export the state of a production as a csv-like structure, ready to be consumed by ABACUS</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L175">view source</a></div></div><div class="public anchor" id="var-export-file"><h3>export-file</h3><div class="usage"><code>(export-file {product_number :product_number, :as production})</code></div><div class="doc"><div class="markdown"><p>Export the state of a production into a special file in <code>export-dir</code>. The file is named with the <code>product_number</code>. Existing files are overwritten</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L197">view source</a></div></div><div class="public anchor" id="var-import-metadata-update"><h3>import-metadata-update</h3><div class="usage"><code>(import-metadata-update f)</code></div><div class="doc"><div class="markdown"><p>Import a metadata update request from file <code>f</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L148">view source</a></div></div><div class="public anchor" id="var-import-new-production"><h3>import-new-production</h3><div class="usage"><code>(import-new-production f)</code></div><div class="doc"><div class="markdown"><p>Import a new production from file <code>f</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L90">view source</a></div></div><div class="public anchor" id="var-import-recorded-production"><h3>import-recorded-production</h3><div class="usage"><code>(import-recorded-production f)</code></div><div class="doc"><div class="markdown"><p>Import a recorded production from file <code>f</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L98">view source</a></div></div><div class="public anchor" id="var-import-status-request"><h3>import-status-request</h3><div class="usage"><code>(import-status-request f)</code></div><div class="doc"><div class="markdown"><p>Import a status request from file <code>f</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L137">view source</a></div></div><div class="public anchor" id="var-read-file"><h3>read-file</h3><div class="usage"><code>(read-file file)</code></div><div class="doc"><div class="markdown"><p>Read an export file from ABACUS and return a map with all the data, i.e. a production</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L76">view source</a></div></div><div class="public anchor" id="var-source-date"><h3>source-date</h3><div class="usage"><code>(source-date {source_edition :source_edition})</code></div><div class="doc"><div class="markdown"><p>Extract the source date from a raw <code>production</code> by taking the last segment of the <code>:source_edition</code></p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L50">view source</a></div></div><div class="public anchor" id="var-wrap-rows"><h3>wrap-rows</h3><div class="usage"><code>(wrap-rows rs)</code></div><div class="doc"><div class="markdown"><p>Wrap an export record according to ABACUS conventions</p></div></div><div class="src-link"><a href="https://github.com/sbsdev/mdr2/blob/master/src/mdr2/abacus.clj#L159">view source</a></div></div></div></body></html>